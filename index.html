<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="app-title">Krish AI Assistant</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for Inter font and Dark Theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        // Pure Black Theme Palette
                        'primary-dark': '#000000', // Pure Black (Used for Header/Footer Background)
                        'surface-dark': '#121212', // Dark Gray Surface (Used for Main Message Area)
                        'gemini-blue': '#4A90E2', // Brightened blue for dark contrast
                        'text-light': '#E5E7EB', // Main text color
                        'input-bg': '#1E1E1E', // Dark gray for chat bubble/Input container
                        
                        // Functional Colors
                        'gemini-green': '#34A853',
                        'gemini-yellow': '#FBBC05',
                        'gemini-red': '#EA4335',
                    }
                }
            }
        }
    </script>
    <style>
        /* Global Dark Mode Setup */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--tw-colors-primary-dark); /* Ensures overall background is black */
            color: var(--tw-colors-text-light);
        }
        
        /* Ensure response area takes up the flexible height */
        #response-area {
            flex-grow: 1;
        }

        /* Custom scrollbar for the response area */
        #response-area::-webkit-scrollbar {
            width: 8px;
        }
        #response-area::-webkit-scrollbar-thumb {
            background-color: #333333; /* Darker thumb */
            border-radius: 10px;
        }
        #response-area::-webkit-scrollbar-track {
            background-color: #000000; /* Pure black track */
        }
        
        /* Input textarea clean look */
        #prompt-input {
            appearance: none;
            outline: none;
        }
        
        /* Basic animation for the loader */
        .dot {
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .dot-2 { animation-delay: -0.32s; }
        .dot-3 { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        
        /* Style list items within bubbles */
        .ai-message ul, .ai-message ol {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .ai-message ul {
            list-style-type: disc;
        }
        .ai-message ol {
            list-style-type: decimal;
        }
        .ai-message li {
            margin-bottom: 0.25rem;
        }
        /* Fade overlay for all modals */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.75);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Fixed Header -->
    <header class="sticky top-0 w-full p-3 bg-primary-dark border-b border-gray-900 shadow-md flex items-center justify-between z-10">
        <div class="flex items-center">
            <!-- Settings/Menu Button (Top Left) -->
            <button id="menu-button" class="p-2 mr-3 text-text-light rounded-full hover:bg-input-bg transition">
                <!-- Menu Icon -->
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
            <h1 id="header-title" class="text-xl font-semibold text-text-light">Krish AI Assistant</h1>
        </div>
        <!-- Error Message Box -->
        <div id="error-message" class="hidden p-2 bg-gemini-red/20 border border-gemini-red text-gemini-red rounded-lg text-xs transition duration-300">
            <!-- Error message will be inserted here -->
        </div>
    </header>

    <!-- Menu Dropdown (Smaller, positioned below header, slides out from the left) -->
    <div id="menu-dropdown" class="hidden fixed top-0 left-0 pt-[3.5rem] pl-2 z-40">
        <div class="w-64 bg-input-bg rounded-xl shadow-2xl p-4 transition-transform duration-300 transform translate-x-[-100%]" id="menu-content">
            <h2 id="menu-title" class="text-xl font-bold mb-4 text-center text-text-light">Menu</h2>
            
            <!-- New Chat Button (Functional) -->
            <button id="new-chat-button" class="menu-option w-full py-3 mb-2 text-base font-medium bg-surface-dark hover:bg-gray-800 text-text-light rounded-lg transition duration-200 flex items-center px-4" onclick="handleNewChat()">
                <!-- New Chat Icon -->
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                New Chat
            </button>
            
            <!-- Settings Button (Now opens Language Modal) -->
            <button id="settings-button" class="menu-option w-full py-3 mb-2 text-base font-medium bg-surface-dark hover:bg-gray-800 text-text-light rounded-lg transition duration-200 flex items-center px-4" onclick="toggleLanguageModal(true)">
                <!-- Settings Icon -->
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.526.315 1.144.5 1.724.5h.001z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                Settings
            </button>
            
            <!-- About Us Button (Now opens About Modal) -->
            <button id="about-us-button" class="menu-option w-full py-3 text-base font-medium bg-surface-dark hover:bg-gray-800 text-text-light rounded-lg transition duration-200 flex items-center px-4" onclick="toggleAboutModal(true)">
                <!-- About Us Icon -->
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                About Us
            </button>

            <button id="menu-close-button" onclick="toggleMenu(false)" class="w-full mt-4 py-2 text-sm text-gray-400 hover:text-white transition">Close</button>
        </div>
    </div>

    <!-- Language Chooser Modal (Hidden by default, centered overlay) -->
    <div id="language-modal-overlay" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0" onclick="toggleLanguageModal(false)">
        <div class="w-full max-w-sm bg-input-bg rounded-xl shadow-2xl p-6 transform scale-95 transition-transform duration-300" id="language-modal-content" onclick="event.stopPropagation()">
            <h2 id="language-modal-title" class="text-xl font-bold mb-5 text-center text-text-light">Change Language</h2>
            
            <form id="language-form">
                <!-- Language Options -->
                <label class="flex items-center p-3 mb-2 rounded-lg cursor-pointer hover:bg-surface-dark transition">
                    <input type="radio" name="app-language" value="en" class="form-radio h-5 w-5 text-gemini-blue bg-surface-dark border-gray-600 focus:ring-gemini-blue" checked>
                    <span class="ml-3 text-base text-text-light">English</span>
                </label>
                <label class="flex items-center p-3 mb-2 rounded-lg cursor-pointer hover:bg-surface-dark transition">
                    <input type="radio" name="app-language" value="es" class="form-radio h-5 w-5 text-gemini-blue bg-surface-dark border-gray-600 focus:ring-gemini-blue">
                    <span class="ml-3 text-base text-text-light">Español (Spanish)</span>
                </label>
                <label class="flex items-center p-3 mb-2 rounded-lg cursor-pointer hover:bg-surface-dark transition">
                    <input type="radio" name="app-language" value="hi" class="form-radio h-5 w-5 text-gemini-blue bg-surface-dark border-gray-600 focus:ring-gemini-blue">
                    <span class="ml-3 text-base text-text-light">हिंदी (Hindi) - Placeholder</span>
                </label>
            </form>

            <div class="flex justify-end mt-6 space-x-3">
                <button id="language-cancel-button" onclick="toggleLanguageModal(false)" type="button" class="px-4 py-2 text-sm font-medium text-gray-400 rounded-lg hover:bg-gray-800 transition">
                    Cancel
                </button>
                <button id="language-apply-button" onclick="handleLanguageApply()" type="button" class="px-4 py-2 text-sm font-medium bg-gemini-blue text-white rounded-lg hover:bg-gemini-blue/90 transition">
                    Apply
                </button>
            </div>
        </div>
    </div>
    
    <!-- About Us Modal (Hidden by default, centered overlay) -->
    <div id="about-modal-overlay" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0" onclick="toggleAboutModal(false)">
        <div class="w-full max-w-sm bg-input-bg rounded-xl shadow-2xl p-6 transform scale-95 transition-transform duration-300" id="about-modal-content" onclick="event.stopPropagation()">
            <h2 id="about-modal-title" class="text-xl font-bold mb-5 text-center text-text-light border-b border-gray-700 pb-3">About Krish AI Assistant</h2>
            
            <div class="space-y-4 text-text-light">
                <p class="text-sm text-gray-400 text-center">
                    This assistant was built by the owner for advanced conversational capabilities, powered by the Gemini API.
                </p>
                <div class="bg-surface-dark p-4 rounded-lg shadow-inner">
                    <p class="text-sm font-semibold text-gemini-blue mb-2">Creator Details:</p>
                    <ul class="space-y-2 text-sm">
                        <li class="flex justify-between">
                            <span class="font-medium text-text-light">Creator Name:</span>
                            <span class="text-gray-400">Karthik</span>
                        </li>
                        <li class="flex justify-between">
                            <span class="font-medium text-text-light">Creator Occupation:</span>
                            <span class="text-gray-400">Software Developer</span>
                        </li>
                        <li class="flex justify-between">
                            <span class="font-medium text-text-light">Admin ID:</span>
                            <span class="text-gray-400">1769584</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="flex justify-center mt-6">
                <button id="about-close-button" onclick="toggleAboutModal(false)" type="button" class="px-6 py-2 text-sm font-medium bg-gemini-blue text-white rounded-lg hover:bg-gemini-blue/90 transition">
                    Close
                </button>
            </div>
        </div>
    </div>


    <!-- Response Display Area (Main Chat View - Now a distinct dark gray surface) -->
    <main id="response-area" class="flex-grow overflow-y-auto p-4 space-y-4 bg-surface-dark">
        <!-- Initial Greeting (Chat Bubble) -->
        <div id="initial-greeting" class="flex justify-start items-start">
            <!-- AI Profile: Now shows "KK" initials -->
            <div class="w-8 h-8 rounded-full bg-gemini-blue text-white flex items-center justify-center mr-2 text-sm font-bold flex-shrink-0">
                KK
            </div>
            <div class="bg-input-bg text-text-light p-3 rounded-2xl rounded-tl-sm shadow-lg max-w-xs md:max-w-md">
                <p id="greeting-title" class="font-bold text-sm text-gemini-blue mb-1">Krish</p>
                <span id="greeting-text">Hello! I'm Krish, an AI assistant ready to help. Ask me anything.</span>
            </div>
        </div>
        <!-- Chat messages will be appended here -->
    </main>

    <!-- Input Form (Fixed at the bottom) -->
    <div class="w-full p-4 bg-primary-dark shadow-2xl sticky bottom-0">
        <!-- Input container, centered and rounded pill -->
        <div class="max-w-xl mx-auto flex items-end bg-input-bg rounded-3xl p-2 shadow-xl border border-gray-800">
            
            <textarea id="prompt-input" rows="1" placeholder="Ask Krish anything..."
                      class="flex-grow bg-transparent text-text-light resize-none border-none focus:ring-0 placeholder-gray-500 py-1.5 px-3 overflow-hidden h-auto text-base"
                      onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); handleAsk(); }"
                      style="min-height: 2.5rem; max-height: 10rem;"></textarea>
            
            <button id="ask-button" onclick="handleAsk()"
                    class="h-9 w-9 bg-gemini-blue text-white rounded-full flex items-center justify-center ml-2 hover:bg-opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed">
                <!-- Send Icon (Paper Airplane) -->
                <svg id="button-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2.01 21.01c-.02-.82.16-1.55.5-2.2L6.85 13l-4.34-5.8c-.34-.65-.52-1.38-.5-2.2a.997.997 0 011.52-1.04l18 8a1 1 0 010 1.99l-18 8a.997.997 0 01-1.52-1.04z" />
                </svg>
                <span id="loading-indicator" class="hidden">
                    <span class="dot w-1.5 h-1.5 bg-white rounded-full mx-0.5"></span>
                    <span class="dot dot-2 w-1.5 h-1.5 bg-white rounded-full mx-0.5"></span>
                    <span class="dot dot-3 w-1.5 h-1.5 bg-white rounded-full mx-0.5"></span>
                </span>
            </button>
        </div>
    </div>

    <script>
        // --- Configuration and State ---
        
        const API_KEY = ""; // Canvas will automatically provide the API key
        const MODEL = "gemini-2.5-flash-preview-09-2025";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;
        
        let currentLanguage = 'en'; // Global state for language

        // Data for the About Modal - Creator name is Karthik here, as requested
        const OWNER_INFO = {
            name: "Karthik",
            occupation: "Software Developer",
            adminId: "1769584"
        };

        const UI_TEXT = {
            'en': {
                title: "Krish AI Assistant",
                greetingTitle: "Krish",
                greetingText: "Hello! I'm Krish, an AI assistant ready to help. Ask me anything.",
                menuTitle: "Menu",
                menuSettings: "Settings",
                menuNewChat: "New Chat",
                menuAbout: "About Us",
                menuClose: "Close",
                chatPlaceholder: "Ask Krish anything...",
                languageTitle: "Change Language",
                languageSave: "Apply",
                languageCancel: "Cancel",
                newChatConfirmation: "--- New Chat Started ---",
                // About Modal Text (Title uses Krish, Content uses OWNER_INFO.name which is Karthik)
                aboutTitle: "About Krish AI Assistant",
                aboutDescription: "This assistant was built by the owner for advanced conversational capabilities, powered by the Gemini API.",
                aboutOwnerDetails: "Creator Details:",
                aboutNameLabel: "Creator Name:",
                aboutOccupationLabel: "Creator Occupation:",
                aboutAdminIdLabel: "Admin ID:",
                aboutClose: "Close",
            },
            'es': {
                title: "Asistente de IA Krish",
                greetingTitle: "Krish",
                greetingText: "¡Hola! Soy Krish, un asistente de IA listo para ayudarte. Pregúntame lo que quieras.",
                menuTitle: "Menú",
                menuSettings: "Ajustes",
                menuNewChat: "Nuevo Chat",
                menuAbout: "Acerca de Nosotros",
                menuClose: "Cerrar",
                chatPlaceholder: "Pregúntale algo a Krish...",
                languageTitle: "Cambiar Idioma",
                languageSave: "Aplicar",
                languageCancel: "Cancelar",
                newChatConfirmation: "--- Nuevo Chat Iniciado ---",
                // About Modal Text
                aboutTitle: "Acerca del Asistente de IA Krish",
                aboutDescription: "Este asistente fue construido por el propietario para capacidades conversacionales avanzadas, impulsado por la API de Gemini.",
                aboutOwnerDetails: "Detalles del Creador:",
                aboutNameLabel: "Nombre del Creador:",
                aboutOccupationLabel: "Ocupación del Creador:",
                aboutAdminIdLabel: "ID de Administrador:",
                aboutClose: "Cerrar",
            },
             'hi': { // Placeholder for Hindi
                title: "कृष एआई सहायक",
                greetingTitle: "कृष",
                greetingText: "नमस्ते! मैं कृष हूँ, एक AI सहायक आपकी मदद के लिए तैयार है। मुझसे कुछ भी पूछें।",
                menuTitle: "मेन्यू",
                menuSettings: "सेटिंग्स",
                menuNewChat: "नई चैट",
                menuAbout: "हमारे बारे में",
                menuClose: "बंद करें",
                chatPlaceholder: "कृष से कुछ भी पूछें...",
                languageTitle: "भाषा बदलें",
                languageSave: "लागू करें",
                languageCancel: "रद्द करें",
                newChatConfirmation: "--- नई चैट शुरू हुई ---",
                // About Modal Text
                aboutTitle: "कृष एआई सहायक के बारे में",
                aboutDescription: "यह सहायक उन्नत संवादात्मक क्षमताओं के लिए मालिक द्वारा बनाया गया था, जो जेमिनी एपीआई द्वारा संचालित है।",
                aboutOwnerDetails: "निर्माता का विवरण:",
                aboutNameLabel: "निर्माता का नाम:",
                aboutOccupationLabel: "निर्माता का पेशा:",
                aboutAdminIdLabel: "एडमिन आईडी:",
                aboutClose: "बंद करें",
            },
        };

        // --- DOM Elements ---
        const promptInput = document.getElementById('prompt-input');
        const askButton = document.getElementById('ask-button');
        const loadingIndicator = document.getElementById('loading-indicator');
        const buttonIcon = document.getElementById('button-icon');
        const responseArea = document.getElementById('response-area');
        const errorMessageDiv = document.getElementById('error-message');

        // Menu D
